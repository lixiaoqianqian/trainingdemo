<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Using API</title>
        <body>
            <h1>List of Users</h1>
            <ul id="userlist">

            </ul>
            <h1>Add new user</h1>
            <form id="addUserForm">
                <input type="text" id="name" placeholder="Enter name" required>
                <button type="submit">Add User</button>
            </form>

            <script>
                const userlist = document.getElementById('userlist');
                const userForm = document.getElementById('addUserForm');
                const username = document.getElementById('name');

                //function to fetch and display users
                function getAllUsers(){
                    fetch('/users')
                    .then(res=>res.json())
                    .then (users=>{
                        userlist.innerHTML = '';
                        users.forEach(user => {
                            const li = document.createElement('li');
                            li.textContent = ` ${user.name}`;
                            userlist.appendChild(li);
                        });
                    })
                }
                addUserForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const name = username.value;
                    if(!name) return;
                    // post the name to the api
                    fetch('/users', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({name})
                    })
                    .then(res => res.json())
                    .then(user => {
                        console.log('User added:', user);
                        getAllUsers(); // Refresh the user list
                        userForm.reset(); // Clear the form
                    })
                    .catch(err => console.error('Error adding user:', err));
                });

                getAllUsers();
            </script>
        </body>
    </head>
</html>